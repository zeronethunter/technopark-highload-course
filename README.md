# Course work

# Amazon

## Содержание

* ### [Тема и целевая аудитория](#1)
    - #### [Тема](#1.1)
    - #### [Целевая аудитория](#1.2)
* ### [Расчет нагрузки](#2)
    - #### [Продуктовые метрики](#2.1)
    - #### [Технические метрики](#2.2)
* ### [Логическая схема](#3)

## 1. Тема и целевая аудитория <a name="1"></a>

### 1.1 Тема <a name="1.1"></a>

**[Amazon](https://www.amazon.com/)** - это американская организация, одна из крупнейших в мире среди компаний,
занимающихся продажей всевозможных товаров и услуг через интернет. Также это лидер в области продаж товаров массового
спроса через систему интернет-сервисов.

### MVP:

- Создание профиля покупателя / продавца.
- Добавление товара в корзину.
- Оформление заказа.
- Оценка товара с возможностью оставить комментарий.
- Навигация по товарам (каталог / поиск).
- Создание товаров / каталогов для продавцов.
- Склады и логистика.

### 1.2 Целевая аудитория <a name="1.2"></a>

- Месячный трафик составляет около 2.5 млрд. пользователей
- Аудитория на 59.8% состоит из мужчин и на 40.2% из женщин
- Самая большая возрастная группа посетителей - 25-34-летние (~0.7 млрд.)
- Таргетинг по странам:

| Страна         | Кол-во пользователей в месяц, % | Кол-во пользователей в месяц, млн |
|----------------|---------------------------------|-----------------------------------|
| США            | 82.67                           | 2 066 750                         |
| Канада         | 1.07                            | 26 750                            |
| Индия          | 1.06                            | 26 500                            |
| Великобритания | 0.97                            | 24 250                            |
| Япония         | 0.72                            | 18 000                            |

### [Источник](https://www.similarweb.com/ru/website/amazon.com/)

## 2. Расчет нагрузки <a name="2"></a>

### 2.1 Продуктовые метрики <a name="2.1"></a>

- Дневная аудитория ~28
  млн. [Источник](https://vc.ru/trade/594954-top-zarubezhnyh-marketpleysov-dlya-prodazhi-tovarov-v-2023-amazon-etsy-i-drugie)
- Месячная аудитория ~ 300 млн. [Источник](https://sell.amazon.com/blog/amazon-stats)

### Средний размер хранилища пользователя:

| Вид данных                                                          | Размер |
|---------------------------------------------------------------------|--------|
| Аватар                                                              | ~2 Мб  |
| Личные данные (адреса, заказы, платежные данные, транзакции и т.д.) | ~1 Мб  |

Итого: ~3 Мб

### Общая статистика:

- Amazon доставляет 1.6 млн. посылок в день **(1)**
- В Amazon 9.1 млн. продавцов, из которых 2.3 млн. активных

[Источник](https://landingcube.com/amazon-statistics/)

- ~40% пользователей совершают покупку 1-2 раза в месяц **(1)**

[Источник](https://amzmln.com/stati/amazon/statistika-amazon/)

> **(1)** Amazon доставляет **1.6** * 30 = 48 млн. посылок в месяц, также активных пользователей в месяц 300 млн, из них
> 40% = 120 млн. совершают 1 - 2 покупки в месяц. Соответственно, получаем, что в среднем пользователь заказывает (с
> добавлением в корзину) 120 * 1.5 / 48 = 3.75 товаров, однако это для 40% пользователей ⇒ получаем ~ **2 товара в
> посылке
** в среднем для одного пользователя.
> Выходит ~ **0.16 заказов на пользователя в месяц**. (48 млн. заказов / 300 млн. пользователей)
> И 0.16 * 2 = **0.32 товара на пользователя в месяц**.
> Предположим, что рядовой пользователь добавляет **5 товаров в корзину в месяц**.

- 6,264 продавцов присоединяются к Amazon ежедневно

[Источник](https://financesonline.com/amazon-statistics/)

- Согласно отчету статистической компании Marketplace Pulse на июнь 2021 года, на Amazon есть более 2,5 миллиона
  продавцов, и среди них наибольшее количество товаров предлагают крупные магазины и бренды, которые имеют более 10 000
  товаров в своем ассортименте. Однако, большинство продавцов на Amazon имеют от 1 до 100 товаров в своем ассортименте.

> Предположим, что в среднем продавец создает **5 товаров** в месяц.
>

- 1-3% пользователей оставляют ревью после покупки товара **(2)**

[Источник](https://www.quora.com/What-percentage-of-buyers-write-reviews-on-Amazon)

> **(2)** 2% пользователей в месяц (300 * 2% = 6 млн) оставляют отзыв в месяц на товар. В среднем в месяц 1 пользователь
> приобретает 2 товара. Получается, что 6 млн пользователей в месяц остовляют отзыв о 2-х купленных товарах ⇒ 6 млн *
> 2 = 12 млн товаров в месяц пополняются отзывом. Найдем процент от общего количества товаров в месяц: 12 млн / 48 млн *
> 2 = 1.25 %. Один пользователь в месяц покупает 0.32 товара ⇒ пользователь оставляет 0.32 * 1.25% = 0.004 отзывов в
> месяц.

### Среднее количество действий пользователя по типам:

| Тип запроса                                       | Запросов в месяц |
|---------------------------------------------------|------------------|
| Добавление товара в корзину                       | 5                |
| Оформление заказа                                 | 0.16             |
| Покупка товара                                    | 0.32             |
| Оценка товара с возможностью оставить комментарий | 0.004            |
| Создание товаров / каталогов                      | 5                |

### 2.2 Технические метрики <a name="2.2"></a>

### Хранилище товара

- Amazon рекомендует, чтобы размер изображения составлял не менее 1000 пикселей в высоту или ширину, и чтобы для
  достижения оптимального качества и сжатия использовать формат файла JPEG или PNG. В общем, размер фото товара на
  Amazon может колебаться от нескольких десятков килобайт до нескольких мегабайт, в зависимости от размеров изображения
  и его качества, возьмем среднее **1 Мб на фото**. Учитываем, что для электронных товаров, которые являются наиболее
  популярными продавцы часто прикрепляют еще и видео.
- В целом, количество фотографий для листинга продукта на Amazon может быть от 1 до 10 и более. Возьмем 5 фотографий (1
  Мб) + 2 видео (предположим 5Мб) + описание на 1 Кб, то есть приходится около 5 * 1 + 2 * 5 Мб ~= **15 Мб данных на
  каждый товар**.

[Источник](https://www.repricerexpress.com/amazon-statistics/)

- Всего товаров примерно 125 млн (учитываем, что 2.5 млн. продавцов имеют в среднем 50 товаров).

### Хранилище пользователя

- Не стоит забывать о пользователях, которые в среднем занимают 3 Мб данных.
  Активных пользователей 300 млн в месяц.

### Логистика

- Учитывая, что в месяц проходит 48 млн. заказов, каждый из которых имеет расписание доставки (1 Кб) и местоположение (1
  Кб). Получаем, что это добавляет ~100 Тб в месяц. Предположим, что данные о товарах хранятся около 10 лет (с запасом
  для статистики, аналитики, возврата, гарантии и т.д.).

> 48 000 000 * 2 * 12 * 10 = 11 520 000 000 Кб = 11 520 000 Мб

#### Итого выходит:

> 125 000 000 * 15 + 300 000 000 * 3 + 11 520 000 = 2 786 520 000 Мб = 2 786 520 Гб = 2 786 Тб

Итого: **2 786 Тб** или 2.786 Пб

### Сетевой трафик

- В месяц 2.5 млрд. (~1000 пользователей в секунду) посетителей сайта, которые
  в [среднем](https://www.similarweb.com/ru/website/amazon.com/#traffic) посещают около 9 страниц за 7 минут.

Предположим, что общий RPS сайта `1000 * 2 = 2000`, где берутся в учет ретраи, долгие выполнения, ошибки и т.д.

| Место      | Формула                          | Кол-во подгружаемых товаров |
|------------|:---------------------------------|:----------------------------|
| Каталог    | 24 товара + 20 * 2 рекомендаций  | 64                          |
| Поиск      | 16 товаров + 20 * 2 рекомендаций | 56                          |
| Сортировка | аналогично каталогу              | 64                          |
| Товар      | 1 товар                          | 1                           |

Для того, чтобы подсчитать RPS, нужно обусловить распределение по типам запросов:

| Действие             | Распределение | RPS  |
|----------------------|---------------|------|
| Отображение каталога | 50%           | 1000 |
| Страница поиска      | 25%           | 500  |
| Сортировка товаров   | 20%           | 400  |
| Отображение товара   | 5%            | 100  |

Покупки и оформление заказа не учитываем, так как это крайне редкие действия.

#### Вычисляем трафик:

* Клик на товар подгружает 15 Мб данных.
* Предпросмотр товара подгружает
    * Рейтинг товара (1 Кб)
    * Сжатую картинку (500 Кб)

Протокол передачи **HTTPS**.

| RPS  | Вес единицы | Кол-во единиц | Сумма                       |
|------|-------------|---------------|-----------------------------|
| 1000 | 500 Кб      | 64            | 64 * 500 Кб * 1000 = 32 Гб  |
| 500  | 500 Кб      | 56            | 56 * 500 Кб * 500 = 14 Гб   |
| 400  | 500 Кб      | 64            | 64 * 500 Кб * 400 = 12.8 Гб |
| 100  | 15 Мб       | 1             | 1 * 150 Мб * 100 = 15 Гб    |

Итого:

> 32 + 14 + 12.8 + 15 = 73.8 Гбайт/с = 590.4 Гбит/с
>
>
> 73.8 * 24 = 1771.2 Гбайт/c

Трафик в секунду: **590.4 Гбит/с**

Трафик в сутки: **1771.2 Гбайт/c**

### Пиковый

Предположим, что пиковый трафик вырастает в 2 раза, тогда имеем:

Трафик в секунду: **1180.8 Гбит/с**

Трафик в сутки: **3542.4 Гбайт/с**

### RPS

### Средний

1. Оформление заказа
   1.6 млн. заказов в день ⇒ **18.5 заказов в секунду**.
2. Покупка товара
   Так как в одном заказе в среднем 2 товара, то RPS на покупку товара будет больше в 2 раза ⇒ **37 товаров в секунду**.
3. Отзыв о товаре
   300 млн * 0.004 = 1.2 млн отзывов в месяц. 1.2 млн / 30 дней / 24 часа / 60 минут / 60 секунд = **0.46 отзывов в
   секунду.**
4. Поиск
   **500 поисков в секунду**.
5. Просмотр каталога товаров
   **1000 каталогов в секунду**
6. Сортировка товара
   **400 сортировок в секунду**
7. Просмотр товара (превью)
   (56 + 64 * 2) / 3 = 61.3 товара в среднем отображается. Запросов на просмотр в сумме 1 900 => 1 900 * 61.3 = **116
   533 превью в секунду**.
8. Просмотр товара (полностью)
   **100 просмотров товара полностью в секунду**
9. Создание товара
   Пренебрежем этим действием, так как оно просиходит очень редко и, соответственно, не особо влияет на загруженность
   системы.

### Пиковый

Предположим, что рост RPS в пике будет в 2 раза больше:

| Тип запроса                 | Средний RPS | Пиковый RPS |
|-----------------------------|-------------|-------------|
| Оформление заказа           | 18.5        | 37          |
| Покупка товара              | 37          | 74          |
| Отзыв о товаре              | 0.74        | 1.48        |
| Поиск                       | 500         | 1 000       |
| Просмотр каталога           | 1 000       | 2 000       |
| Сортировка товаров          | 400         | 800         |
| Просмотр товара (превью)    | 116 533     | 233 066     |
| Просмотр товара (полностью) | 100         | 200         |
| Создание товара             | 0           | 0           |

## 3. Логическая схема <a name="3"></a>

![Untitled(1).png](imgs/logic-schema.png)